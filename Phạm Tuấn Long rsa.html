<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <title>RSA Interactive Tool</title>
  <style>
    body {
      font-family: 'Segoe UI', Tahoma, sans-serif;
      background: linear-gradient(135deg, #e3f2fd, #fce4ec);
      margin: 0;
      padding: 40px;
    }
    h2 {
      text-align: center;
      color: #333;
      margin-bottom: 25px;
    }
    .container {
      max-width: 600px;
      margin: auto;
      background: #fff;
      padding: 25px 30px;
      border-radius: 12px;
      box-shadow: 0 8px 20px rgba(0,0,0,0.1);
    }
    .box {
      background: #f9f9f9;
      border-left: 4px solid #2196f3;
      padding: 15px;
      border-radius: 8px;
      margin-bottom: 20px;
      font-size: 15px;
    }
    label {
      font-weight: bold;
      display: block;
      margin: 8px 0 5px;
    }
    input {
      width: 100%;
      padding: 10px;
      border: 1px solid #ccc;
      border-radius: 6px;
      margin-bottom: 15px;
      font-size: 14px;
      transition: border 0.2s;
    }
    input:focus {
      border: 1px solid #2196f3;
      outline: none;
    }
    button {
      background: #2196f3;
      color: white;
      border: none;
      padding: 10px 18px;
      margin-right: 10px;
      border-radius: 6px;
      font-size: 14px;
      cursor: pointer;
      transition: 0.3s;
    }
    button:hover {
      background: #e8450e;
    }
    #output {
      background: #212121;
      color: #e0e0e0;
      padding: 15px;
      border-radius: 8px;
      font-family: Consolas, monospace;
      white-space: pre-wrap;
      font-size: 14px;
    }
  </style>
</head>
<body>
  <h2>üîë RSA Interactive Tool</h2>
    <h3>L√Ω thuy·∫øt</h3>
    <div class="theory">
      <b>Nguy√™n l√Ω RSA:</b><br>
      - Ch·ªçn 2 s·ªë nguy√™n t·ªë l·ªõn p, q.<br>
      - T√≠nh <i>n = p¬∑q</i>, <i>œÜ(n) = (p-1)(q-1)</i>.<br>
      - Ch·ªçn s·ªë <i>e</i> sao cho gcd(e, œÜ(n)) = 1.<br>
      - T√¨m <i>d</i> l√† ngh·ªãch ƒë·∫£o modular c·ªßa e mod œÜ(n).<br>
      - Kh√≥a c√¥ng khai: (e, n), kh√≥a b√≠ m·∫≠t: (d, n).<br><br>

      <b>T·∫°i sao RSA b·∫£o m·∫≠t?</b><br>
      - B·∫£o m·∫≠t d·ª±a tr√™n vi·ªác kh√≥ ph√¢n t√≠ch th·ª´a s·ªë n th√†nh p v√† q.<br>
      - N·∫øu kh√¥ng bi·∫øt p, q th√¨ kh√¥ng th·ªÉ t√≠nh d t·ª´ e.<br><br>

      <b>H·ªá s·ªë e ph·ªï bi·∫øn:</b><br>
      - Th∆∞·ªùng ch·ªçn e = 65537 (2^16+1).<br>
      - L√Ω do: s·ªë nguy√™n t·ªë, nh·ªè v·ª´a ph·∫£i, gi√∫p m√£ ho√° nhanh v√† an to√†n.<br><br>

      <b>Padding (PKCS#1 v1.5 vs OAEP):</b><br>
      - N·∫øu ch·ªâ m√£ ho√° m^e mod n th√¨ d·ªÖ b·ªã t·∫•n c√¥ng (ch·ªçn b·∫£n r√µ).<br>
      - C·∫ßn th√™m <i>padding</i> ƒë·ªÉ ng·∫´u nhi√™n h√≥a d·ªØ li·ªáu tr∆∞·ªõc khi m√£ ho√°.<br>
      - PKCS#1 v1.5: padding ƒë∆°n gi·∫£n, c≈©.<br>
      - OAEP: padding hi·ªán ƒë·∫°i, an to√†n h∆°n, ch·ªëng t·∫•n c√¥ng ch·ªçn b·∫£n r√µ.<br>
    </div>
    <br>

  <div class="box">
    <label>Nh·∫≠p p (s·ªë nguy√™n t·ªë):</label><br>
    <input type="number" id="p" value="61"><br>

    <label>Nh·∫≠p q (s·ªë nguy√™n t·ªë):</label><br>
    <input type="number" id="q" value="53"><br>

    <label>Nh·∫≠p e (1 < e < œÜ(n)):</label><br>
    <input type="number" id="e" value="17"><br>

    <label>Plaintext m (s·ªë &lt; n):</label><br>
    <input type="number" id="m" value="65"><br><br>

    <button onclick="generateKeys()">T·∫°o kh√≥a</button>
    <button onclick="encrypt()">M√£ ho√°</button>
    <button onclick="decrypt()">Gi·∫£i m√£</button>
  </div>

  <div class="box">
    <b>K·∫øt qu·∫£:</b>
    <pre id="output"></pre>
  </div>

  <script>
    // --- H√†m ti·ªán √≠ch ---
    function egcd(a, b) {
      if (b === 0n) return [a, 1n, 0n];
      let [g, x1, y1] = egcd(b, a % b);
      return [g, y1, x1 - (a / b) * y1];
    }

    function modInverse(a, m) {
      let [g, x, y] = egcd(a, m);
      if (g !== 1n) throw new Error("Kh√¥ng c√≥ ngh·ªãch ƒë·∫£o modular");
      return (x % m + m) % m;
    }

    function modPow(base, exp, mod) {
      let result = 1n;
      base = base % mod;
      while (exp > 0n) {
        if (exp % 2n === 1n) result = (result * base) % mod;
        exp /= 2n;
        base = (base * base) % mod;
      }
      return result;
    }

    // --- Bi·∫øn to√†n c·ª•c ---
    let n, phi, d, ciphertext;

    function generateKeys() {
      const p = BigInt(document.getElementById("p").value);
      const q = BigInt(document.getElementById("q").value);
      const e = BigInt(document.getElementById("e").value);

      n = p * q;
      phi = (p - 1n) * (q - 1n);

      try {
        d = modInverse(e, phi);
      } catch (err) {
        document.getElementById("output").textContent = "‚ùå e kh√¥ng h·ª£p l·ªá: " + err.message;
        return;
      }

      let log = "";
      log += `p = ${p}\nq = ${q}\n`;
      log += `n = p*q = ${n}\n`;
      log += `phi(n) = (p-1)(q-1) = ${phi}\n`;
      log += `Public key: (n=${n}, e=${e})\n`;
      log += `Private key: d = ${d}\n`;
      log += `Ki·ªÉm tra: (e*d) mod phi = ${(e*d)%phi}\n`;

      document.getElementById("output").textContent = log;
    }

    function encrypt() {
      if (!n || !d) {
        alert("H√£y t·∫°o kh√≥a tr∆∞·ªõc!");
        return;
      }
      const m = BigInt(document.getElementById("m").value);
      if (m >= n) {
        alert("Plaintext ph·∫£i nh·ªè h∆°n n = " + n);
        return;
      }
      const e = BigInt(document.getElementById("e").value);
      ciphertext = modPow(m, e, n);
      document.getElementById("output").textContent += `\nM√£ ho√°: c = m^e mod n = ${ciphertext}`;
    }

    function decrypt() {
      if (!ciphertext) {
        alert("H√£y m√£ ho√° tr∆∞·ªõc!");
        return;
      }
      const mRecovered = modPow(ciphertext, d, n);
      document.getElementById("output").textContent += `\nGi·∫£i m√£: m' = c^d mod n = ${mRecovered}`;
    }
  </script>
</body>
</html>
